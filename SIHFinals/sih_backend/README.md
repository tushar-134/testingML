# SIH Backend — Fast2SMS / OTP Setup

This README explains how to enable real SMS sending for OTPs via Fast2SMS, how to configure environment variables, and how to test the OTP flow locally.

## Files changed
- `config/db.js`: in development the server no longer exits on DB connection failure so the API stays available for frontend development.
- `controllers/otpController.js`: the OTP value is no longer returned in API responses when `NODE_ENV=production`. In development the OTP is still returned for convenience.
- `.env.example`: added `MONGO_URI`, `FAST2SMS_API_KEY`, and `NODE_ENV` entries.

## Obtain a Fast2SMS API key
1. Sign up at https://www.fast2sms.com and complete account verification.
2. Fast2SMS may require you to add credits or complete a small transaction before API access is enabled. The provider error "You need to complete one transaction of 100 INR or more before using API route." indicates this requirement.
3. From the Fast2SMS dashboard → API keys, generate/copy your API key.

## Configure the backend
1. Copy the example env file and edit values:

```powershell
cd C:\Users\ritik\tushar\sih_backend
Copy-Item .env.example .env
# Edit .env and fill values for MONGO_URI and FAST2SMS_API_KEY
```

2. Example `.env` contents:

```
PORT=5000
MONGO_URI=mongodb+srv://<user>:<password>@cluster0.mongodb.net/<dbname>
FAST2SMS_API_KEY=your_real_fast2sms_api_key_here
# NODE_ENV=production will disable returning OTP in API responses
NODE_ENV=production
```

3. Restart the server after changing `.env`:

```powershell
npm install
npm run start
```

## Test the OTP flow
- Health check:

```powershell
curl.exe http://localhost:5000/
```

- Request OTP (replace with a real mobile number):

```powershell
$body = @{ mobile = '9999999999' } | ConvertTo-Json
Invoke-RestMethod -Uri 'http://localhost:5000/api/auth/send-otp' -Method Post -Body $body -ContentType 'application/json'
```

If Fast2SMS is configured and allowed for your account, the provider should return success and an SMS will be delivered. If SMS sending fails, the server will still save the OTP to the database and (in development) log the OTP to the console for testing.

## Production notes and security
- Do not commit your real `FAST2SMS_API_KEY` or `MONGO_URI` into source control. Use environment variables or a secret manager.
- Consider removing the development convenience of returning OTPs in API responses for any staging environments.
- For production, implement retries or a queue for SMS sending and proper monitoring/alerts on failures.

## Want me to do more?
- I can change the hard-fail behavior so the API returns an error when SMS fails (instead of returning success), add retries/queueing, or add an automated `.env` setup script using PowerShell secret store.

---
Generated by assistant to document enabling real SMS sending via Fast2SMS.
